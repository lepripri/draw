<html lang="fr"><head>
<meta charset="UTF-8">
<title>Éditeur SVG Avancé</title>
<style>
body { margin:0; display:flex; height:100vh; font-family:Arial; }
#tools { width:220px; background:#eee; padding:10px; }
button {padding: 0px;}
#tools button:not(.tools) { width:100%; margin-bottom:5px;}
#canvas { flex:1; border-left:1px solid #aaa; cursor:crosshair; * {cursor: default;}}
#toolsDiv {}
.tools {width: 30px}
.selected { stroke:red !important; }
.handle { fill:white; stroke:black;}
.rotate { fill:yellow; cursor:grab !important; }
</style>
</head>
<body>

<div id="tools"><div id="toolsDiv">
  <button class="tools" onclick="setTool('select')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 20 20" version="1.1">
    
    <title>curseur</title>
    <desc>pointeur de souris noir</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="select" fill="#575E75">
            <path d="M9.08480709,12.7519131 L10.2692937,15.3910753 C10.5025281,15.912848 11.1105098,16.1432755 11.6267701,15.9075508 C12.1430304,15.6705018 12.3710236,15.0560284 12.1377892,14.53558 L10.9669627,11.925728 L13.925853,11.925728 C14.5130486,11.925728 14.7937693,11.2121948 14.3623865,10.8190495 L7.0791007,4.17004294 C6.6670336,3.7934914 6,4.08324462 6,4.63849857 L6,14.5028722 C6,15.0900373 6.73013138,15.3657496 7.12288282,14.9279287 L9.08480709,12.7519131 Z" id="select-icon"></path>
        </g>
    </g>
</svg></button>
  <button class="tools" onclick="setTool('rect')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 20 20" version="1.1">
    
    <title>rectangle</title>
    <desc>créez des réctangles : outils de réctangles</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
        <g id="rectangle" stroke="#575E75" stroke-width="1.5">
            <rect id="rectangle-icon" x="5" y="5" width="10" height="10"></rect>
        </g>
    </g>
</svg></button>
  <button class="tools" onclick="setTool('ellipse')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 20 20" version="1.1">
    
    <title>oval</title>
    <desc>créez des ovals</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="oval" stroke-width="1.5" stroke="#575E75">
            <circle id="oval-icon" cx="10" cy="10" r="5"></circle>
        </g>
    </g>
</svg></button>
  <button class="tools" onclick="setTool('line')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 20 20" version="1.1">
    
    <title>ligne</title>
    <desc>outil ligne : créez des lignes</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="square">
        <g id="line" stroke="#575E75" stroke-width="2">
            <path d="M5,15 L15,5" id="Line"></path>
        </g>
    </g>
</svg></button>
  <button class="tools" onclick="setTool('triangle')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="11.5" height="20" viewBox="0,0,11.5,11.5"><title>trangle</title><desc>outil trangle : créez des triangles</desc><defs></defs><g transform="translate(-234.25,-174.25)"><g fill="none" fill-rule="evenodd" stroke="#575e75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"><path d="M235,185l5.01683,-10l4.98317,10z"></path></g></g></svg></button>
  <button class="tools" onclick="setTool('text')"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20px" height="20px" viewBox="0 0 20 20" version="1.1">
    <!-- Generator: Sketch 43.2 (39069) - http://www.bohemiancoding.com/sketch -->
    <title>text</title>
    <desc>text tool : create and edit text</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="text" fill="#575E75">
            <path d="M16,4.35294118 L16,6.85176471 C16,7.04941176 15.8447059,7.20470588 15.6470588,7.20470588 L14.8988235,7.20470588 C14.7576471,7.20470588 14.6164706,7.12 14.5741176,6.99294118 L14.2070588,6.11764706 L11.0588235,6.11764706 L11.0588235,14.2917647 L11.92,14.6164706 C12.0611765,14.6729412 12.16,14.8 12.16,14.9552941 L12.16,15.6470588 C12.16,15.8447059 11.9905882,16 11.8070588,16 L8.20705882,16 C8.02352941,16 7.85411765,15.8447059 7.85411765,15.6470588 L7.85411765,14.9552941 C7.85411765,14.8 7.95294118,14.6729412 8.08,14.6164706 L8.94117647,14.2917647 L8.94117647,6.11764706 L5.80705882,6.11764706 L5.44,6.99294118 C5.38352941,7.12 5.25647059,7.20470588 5.11529412,7.20470588 L4.35294118,7.20470588 C4.16941176,7.20470588 4,7.04941176 4,6.85176471 L4,4.35294118 C4,4.15529412 4.16941176,4 4.35294118,4 L15.6470588,4 C15.8447059,4 16,4.15529412 16,4.35294118" id="text-icon"></path>
        </g>
    </g>
</svg></button></div>
  <hr>
  <button onclick="exportSVG()">Exporter SVG</button>
  <button onclick="exportPNG()">Convertir en Bitmap</button>
</div>

<svg id="canvas"></svg>

<script>
const svg = document.getElementById("canvas");
const ns = "http://www.w3.org/2000/svg";
let tool="select", current=null, selected=null;
let startX,startY;
let handles=[];

/* ===================== TOOLS ===================== */
function setTool(t){ tool=t; removeHandles(); }

/* ===================== DRAW ===================== */
svg.onmousedown = e => {
  startX=e.offsetX; startY=e.offsetY;
  if(tool==="select"){ select(e.target); return; }
  current=create(tool,startX,startY);
  if(current) svg.appendChild(current);
};
svg.onmousemove = e => {
  if(!current) return;
  let x=e.offsetX,y=e.offsetY;
  if(tool==="rect"){
    current.setAttribute("x",Math.min(x,startX));
    current.setAttribute("y",Math.min(y,startY));
    current.setAttribute("width",Math.abs(x-startX));
    current.setAttribute("height",Math.abs(y-startY));
  }
  if(tool==="ellipse"){
    current.setAttribute("cx",(x+startX)/2);
    current.setAttribute("cy",(y+startY)/2);
    current.setAttribute("rx",Math.abs(x-startX)/2);
    current.setAttribute("ry",Math.abs(y-startY)/2);
  }
};
svg.onmouseup=()=>current=null;

function create(t,x,y){
  let e;
  if(t==="rect"){ e=document.createElementNS(ns,"rect"); e.setAttribute("fill","none"); e.setAttribute("stroke","black"); }
  if(t==="ellipse"){ e=document.createElementNS(ns,"ellipse"); e.setAttribute("fill","none"); e.setAttribute("stroke","black"); }
  if(t==="line"){ e=document.createElementNS(ns,"line"); e.setAttribute("x1",x);e.setAttribute("y1",y);e.setAttribute("x2",x);e.setAttribute("y2",y);e.setAttribute("stroke","black"); }
  if(t==="triangle"){ e=document.createElementNS(ns,"polygon"); e.setAttribute("stroke","black"); e.setAttribute("fill","none"); }
  if(t==="text"){
    let txt=prompt("Texte");
    if(!txt) return null;
    e=document.createElementNS(ns,"text");
    e.setAttribute("x",x); e.setAttribute("y",y);
    e.textContent=txt;
  }
  return e;
}

/* ===================== SELECTION ===================== */
function select(el){
  if(el===svg) return;
  if(selected) selected.classList.remove("selected");
  selected=el;
  selected.classList.add("selected");
  createHandles();
}

/* ===================== HANDLES ===================== */
function createHandles(){
  removeHandles();
  if(!selected.getBBox) return;
  let b=selected.getBBox();
  let pts=[
    [b.x,b.y],[b.x+b.width,b.y],
    [b.x,b.y+b.height],[b.x+b.width,b.y+b.height]
  ];
  const cursors = ["nw-resize","ne-resize","sw-resize","se-resize"];
  pts.forEach((p,i)=>{
    let h=document.createElementNS(ns,"rect");
    h.setAttribute("x",p[0]-4);
    h.setAttribute("y",p[1]-4);
    h.setAttribute("width",8);
    h.setAttribute("height",8);
    h.style.cursor = cursors[i];
    h.classList.add("handle");
    h.onmousedown=e=>resize(e,p);
    svg.appendChild(h);
    handles.push(h);
  });

  // rotation
  let r=document.createElementNS(ns,"circle");
  r.setAttribute("cx",b.x+b.width/2);
  r.setAttribute("cy",b.y-20);
  r.setAttribute("r",6);
  r.classList.add("rotate");
  r.onmousedown=startRotate;
  svg.appendChild(r);
  handles.push(r);
}

function removeHandles(){ handles.forEach(h=>h.remove()); handles=[]; }

/* ===================== RESIZE ===================== */
function resize(e, origin) {
  e.stopPropagation();

  const box = selected.getBBox();
  const isEllipse = selected.tagName === "ellipse";

  svg.onmousemove = ev => {
    let x = ev.offsetX;
    let y = ev.offsetY;

    let w = Math.abs(x - origin[0]);
    let h = Math.abs(y - origin[1]);

    if (isEllipse) {
      selected.setAttribute("rx", w / 2);
      selected.setAttribute("ry", h / 2);
      selected.setAttribute("cx", origin[0] + w / 2);
      selected.setAttribute("cy", origin[1] + h / 2);
    } else {
      selected.setAttribute("x", Math.min(x, origin[0]));
      selected.setAttribute("y", Math.min(y, origin[1]));
      selected.setAttribute("width", w);
      selected.setAttribute("height", h);
    }
  };

  svg.onmouseup = () => {
    svg.onmousemove = null;
    createHandles();
  };
}

/* ===================== ROTATE ===================== */
function startRotate(e){
  e.stopPropagation();
  let box=selected.getBBox();
  let cx=box.x+box.width/2;
  let cy=box.y+box.height/2;
  svg.onmousemove=ev=>{
    let a=Math.atan2(ev.offsetY-cy,ev.offsetX-cx)*180/Math.PI;
    selected.setAttribute("transform",`rotate(${a} ${cx} ${cy})`);
  };
  svg.onmouseup=()=>{ svg.onmousemove=null; };
}

/* ===================== KEYBOARD MOVE ===================== */
document.onkeydown = e => {
  if (!selected) return;

  let step = e.shiftKey ? 10 : 1;
  let dx = 0, dy = 0;

  if (e.key === "ArrowLeft") dx = -step;
  if (e.key === "ArrowRight") dx = step;
  if (e.key === "ArrowUp") dy = -step;
  if (e.key === "ArrowDown") dy = step;
  if (!dx && !dy) return;

  e.preventDefault();

  let t = selected.getAttribute("transform") || "";
  t += ` translate(${dx},${dy})`;
  selected.setAttribute("transform", t);

  createHandles();
};

/* ===================== EXPORT SVG ===================== */
function exportSVG() {
  removeHandles();
  let clone = svg.cloneNode(true);
  let blob = new Blob([clone.outerHTML], { type: "image/svg+xml" });
  download(blob, "dessin.svg");
  createHandles();
}

/* ===================== EXPORT PNG ===================== */
function exportPNG(){
  let img=new Image();
  let data="data:image/svg+xml;base64,"+btoa(svg.outerHTML);
  img.onload=()=>{
    let c=document.createElement("canvas");
    c.width=svg.clientWidth;
    c.height=svg.clientHeight;
    c.getContext("2d").drawImage(img,0,0);
    c.toBlob(b=>download(b,"dessin.png"));
  };
  img.src=data;
}

/* ===================== UTIL ===================== */
function download(blob,name){
  let a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}
</script>



</body></html>
